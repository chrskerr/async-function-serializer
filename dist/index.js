"use strict";var __awaiter=this&&this.__awaiter||function(e,a,u,s){return new(u=u||Promise)(function(n,t){function i(e){try{r(s.next(e))}catch(e){t(e)}}function o(e){try{r(s.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof u?t:new u(function(e){e(t)})).then(i,o)}r((s=s.apply(e,a||[])).next())})};function serialize(i,a){let u=[],s=void 0,c=void 0,l=void 0,d=void 0,v=void 0;const t=(null==a?void 0:a.concurrency)||1;let f=0,n=void 0;function h(){return __awaiter(this,void 0,void 0,function*(){var e;f>=t||(e=0===f,f+=1,e&&null!=a&&a.delay&&(n=new Promise(e=>setTimeout(e,a.delay))),yield n,function n(){return __awaiter(this,void 0,void 0,function*(){if(null!=a&&a.sortBy){const o=a.sortBy.key,r=a.sortBy.direction||"asc";u=u.sort((e,t)=>{const n=("asc"===r?e:t).input[o],i=("asc"===r?t:e).input[o];return"number"==typeof n&&"number"==typeof i?n-i:"string"==typeof n&&"string"==typeof i?n.localeCompare(i):0})}const t=u.shift();if(t){null!=a&&a.inputTransformer&&(t.input=yield a.inputTransformer(t.input,s));try{const e=yield i(t.input);t.resolve({data:e}),s=e}catch(e){t.resolve({message:e})}}u.length?yield n():--f})}())})}return function(r){return __awaiter(this,void 0,void 0,function*(){return yield new Promise(e=>{if(null!=a&&a.batch){const{debounceInterval:n,batchTransformer:i,maxDebounceInterval:o}=a.batch;l=l||(new Date).valueOf();var t=o?Math.max((new Date).valueOf()-l,0):0,t=o?Math.max(o-t,0):1/0,t=Math.min(n,t);c&&clearTimeout(c),d=i(d,r),v&&v({message:"batched"}),v=e,c=setTimeout(()=>{u.push({resolve:e,input:d||r}),d=void 0,v=void 0,l=void 0,h()},t)}else u.push({resolve:e,input:r}),h()})})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=serialize;